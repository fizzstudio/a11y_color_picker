<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Accessible Color Picker</title>
    <style media="screen">
    /* .slidecontainer {
width: 100%;
}
//default slider taken from https://www.w3schools.com/howto/howto_js_rangeslider.asp
.slider {
-webkit-appearance: none;
width: 100%;
height: 25px;
background: #d3d3d3;
outline: none;
opacity: 0.7;
-webkit-transition: .2s;
transition: opacity .2s;
}

.slider:hover {
opacity: 1;
}

.slider::-webkit-slider-thumb {
-webkit-appearance: none;
appearance: none;
width: 25px;
height: 25px;
background: #4CAF50;
cursor: pointer;
}

.slider::-moz-range-thumb {
width: 25px;
height: 25px;
background: #4CAF50;
cursor: pointer;
} */
      p {
        color: blue;
        font-family: Helvetica, sans-serif;
      }
      /* input {
        width: 100px;
      } */
      /* div#a11y_color_picker_swatch {
        width: 200px;
        height: 200px;
        background-color: black;
      }
      ul {
        list-style: none;
        margin-left: 0;
      }
      label {
        display: inline-block;
        width: 5em;
      }
      button {
        width: 100px;
        height: 40px;
        background-color: rgb(90, 156, 211);
      }
      button:hover {
        background: rgb(146, 201, 239);
      } */
    </style>
  </head>
  <body>
<h1>Accessible Color Picker</h1>
<p>This is a Color Picker usable by people with visual or motor disabilities.</p>
<button id="button" onclick="toggleColorPicker()" style="background-color:rgb(90, 156, 211); color: white;">Create Color Picker</button>
<script>
// finish inline styles
// challenge: see if you can have multiple color pickers in the same page
// setTextColor, setBackgroundColor
// each of these controls should output to its own text inputs
// after button put a text element; set hsla to that element
// research "making form controls accessible" i.e. tab index

  var picker = null;

  function toggleColorPicker() {
    // creates color picker onclick
      // document.getElementById("button").hover.backgroundColor = 'rgb(146, 201, 239)';
      if(picker === null) {
        var container = document.getElementById("color_picker_container");
        picker = new A11yColorPicker(container, 200, 200);
        document.getElementById("button").textContent = "Close Color Picker";
      } else {
        var color = picker.close();
        picker = null;
        console.log(color);
      }
      console.log("button clicked");
  }

  class A11yColorPicker {

    constructor(container, width, height) {
      this.container = container;
      this.swatch_width = width;
      this.swatch_height = height;
      this.hsla = null;
      this.color = {
        hue: 0,
        saturation: 50,
        lightness: 50,
        alpha: 100
      }
      this.createSwatch(this.container);
      this.createColorLabel();
      this.createInputs();
    }

    close() {
      while(this.container.firstChild) {
        this.container.firstChild.remove();
        document.getElementById("button").textContent = "Create Color Picker";
      }
      return this.hsla;
    }

    createSwatch() {
      var swatch = document.createElement("div");
      swatch.id = "a11y_color_picker_swatch";
      swatch.style.backgroundColor = 'black';
      swatch.style.width = this.swatch_width+'px';
      swatch.style.height = this.swatch_height+'px';
      this.container.appendChild(swatch);
      // CREATES SWATCH_SIZE INPUT TO ADJUST ITS WIDTH/HEIGHT
      var swatch_size = document.createElement("input");
      swatch_size.type = "number";
      swatch_size.min = 200;
      swatch_size.max = 500;
      swatch_size.addEventListener("change", this.getValue_swatch.bind(this), false);
      this.container.appendChild(swatch_size);
      // CREATES SWATH_SIZE LABEL
      var swatch_size_label = document.createTextNode("Adjust Picker Size: ");
      this.container.insertBefore(swatch_size_label, swatch_size);
      console.log("swatch created");
    }

    createInputs() {
      var inputs = ["hue", "saturation", "lightness", "alpha"];
      var component_list = document.createElement("ul");
      component_list.style.listStyle = 'none';
      component_list.style.marginLeft = '0';
      this.container.appendChild(component_list);
      var index = 1; // used to create tabindex
      for(var i = 0; i < inputs.length; i++) {
        // create list item for each component
        var component_item = document.createElement("li");
        component_list.appendChild(component_item);
        // create label
        var label = document.createElement("label");
        label.style.display = 'inline-block';
        label.style.width = '5em';
        label.textContent = inputs[i]+": ";
        component_item.appendChild(label);
        // create number input
        var input_num = document.createElement("input");
        input_num.style.width = 100+'px';
        input_num.style.borderColor = "grey";
        input_num.type = "number";
        input_num.classList.add("a11y_color_picker");
        input_num.dataset.component = inputs[i];
        input_num.style.tabindex = index;
        index++;
        // create range input
        var input_range = document.createElement("input");
        input_range.style.width = 100+'px';
        input_range.style.borderColor = "grey";
        input_range.type = "range";
        input_range.classList.add("a11y_color_picker");
        input_range.dataset.component = inputs[i];
        input_range.style.tabindex = index++;
        index++;
        if(inputs[i] == "hue") {
          input_num.min = "0";
          input_range.min = "0";
          input_num.max = "360";
          input_range.max = "360";
          input_num.value = "0";
          input_range.value = "0";
        } else {
          input_num.min = "0";
          input_range.min = "0";
          input_num.max = "100";
          input_range.max = "100";
          input_num.value = "50";
          input_range.value = "50";
        }
        input_num.addEventListener("change", this.getValue.bind(this), false);
        input_range.addEventListener("change", this.getValue.bind(this), false);
        // append number and range inputs to list elements
        component_item.appendChild(input_num);
        component_item.appendChild(input_range);
        console.log("inputs created");
      }
    }

    getValue(e) {
      var input = e.target;
      var val = input.value;
      this.color[input.dataset.component] = val;
      var component_els = document.querySelectorAll("input[data-component=" +input.dataset.component+ "]");
      for(var i=0; i<component_els.length; i++) {
        var each_input = component_els[i];
        each_input.value = val;
        console.log(each_input);
      }
      this.setColor();
    }

    setColor() {
        console.log();
        var swatch = document.getElementById("a11y_color_picker_swatch");
        // console.log(swatch);
        this.hsla = `hsla(${this.color.hue}, ${this.color.saturation}%, ${this.color.lightness}%, ${this.color.alpha}%)`;
        console.log(this.hsla);
        swatch.style.backgroundColor = this.hsla;
        document.getElementById("color_label").textContent = this.hsla;
        // create input box and output new color
    }

    createColorLabel() {
      var color_label = document.createElement("text");
      color_label.textContent = this.hsla;
      color_label.id = "color_label";
      this.container.appendChild(color_label);
    }

    getValue_swatch(e) {
      var input = e.target;
      var val = input.value;
      console.log(val);
      // allows user to change width and height of swatch
      document.getElementById("a11y_color_picker_swatch").style.width = `${val}px`;
      document.getElementById("a11y_color_picker_swatch").style.height = `${val}px`;
    }
  }
 </script>
   <div id="color_picker_container"> </div>
  </body>
</html>
